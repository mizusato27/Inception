*This project has been created as part of the 42 curriculum by mizusato.*

# Inception

## Description
本プロジェクトは、Docker を使用したシステム管理の知識を深めることを目的とする。
Docker Compose を使用し、特定のルールに基づいて複数のサービス（NGINX, WordPress, MariaDB）で構成される小規模なインフラストラクチャを仮想マシン上に構築する。

ゼロから Web サーバスタックを構築することで、コンテナ化、ネットワーク構成、データの永続化といった基盤技術の仕組みを理解することを目指す。

![alt text](image.png)

## Instructions
### 前提条件
* マシンに Docker および Docker Compose がインストールされていること。
* ドメイン `login.42.fr` がローカルIPアドレス（またはポートフォワーディング使用時は `127.0.0.1`）を指すように設定されている

### インストールと実行
1. リポジトリをクローンする
2. コンテナをビルドして起動する
	```bash
	make
	# or
	make build
	```
3. Webサイトにアクセスする:ブラウザを開き、`https://login.42.fr` にアクセスする。
4. サービスを停止する
	```bash
	make down
	```
5. 環境をクリーンアップ（全データ削除）する
	```bash
	make fclean
	```

## Resources
[Docker ドキュメント](https://docs.docker.com/)

[NGINX ドキュメント](https://nginx.org/en/docs/)

[WordPress Codex](https://codex.wordpress.org/Main_Page)

[MariaDB ナレッジベース](https://mariadb.com/docs/)

## Project Description
### 仮想マシン(VM) vs Docker
**【概要】**
* **仮想マシン (Virtual Machine):**
ハイパーバイザー（VirtualBox等）というソフトウェアを介して、物理ハードウェアをエミュレート（模倣）する技術。各VMは独立した「ゲストOS」を持ち、その上でミドルウェアやアプリケーションが稼働する。
* **Docker (コンテナ):**
ホストマシンのOSカーネルを共有しつつ、"Namespace" や "cgroups" といった Linux カーネルの機能を利用して、プロセスの空間を隔離する技術。ゲストOSを持たず、アプリケーションとその実行に必要なライブラリだけをパッケージ化する。

> * **Namespace（名前空間）**
> **プロセスから見えるリソースを分離する機能**。PID（プロセスID）、ネットワーク、マウントポイント、ユーザーIDなどを隔離する。これにより、コンテナ内のプロセスは、ホスト上の他のプロセスやリソースを認識できなくなる。
> - **cgroup（Control Groups）**
> **プロセスグループのリソース使用量を制限・隔離する機能**。CPU時間、物理メモリ量、ディスクI/O、ネットワーク帯域などを制御する。コンテナはホストOSのカーネルを共有する。そのため、コンテナ内で動作するLinuxディストリビューション（DebianやRocky Linuxなど）が異なっていても、実行されるカーネルはホストのもの（または仮想マシン上の単一カーネル）である。LinuxのシステムコールはABI（Application Binary Interface）互換性が保たれているため、異なるディストリビューションのユーザーランドでも同一カーネル上で動作が可能となる。
> * **chroot / pivot_root**
> プロセスのルートディレクトリを変更し、特定のディレクトリ以下しかファイルシステムとしてアクセスできないように制限する機能。
> * **Capability**
> 特権ユーザー（root）の権限を細分化し、プロセスごとに必要な権限のみを付与する機能。これにより、コンテナ内でroot権限を持っていても、カーネルパラメータの変更などホスト全体に影響する操作を制限できる。

**【主な相違点】**
* **アーキテクチャ（OSの有無）:**
VM はそれぞれが重いゲストOSを持つが、Docker はホストのカーネルを共有するためOSの起動が不要である。
* **リソース消費と起動速度:**
VM はGB単位のメモリとストレージを占有し起動に数分かかるが、Docker はMB単位で済み、起動は数秒（ほぼ一瞬）である。
* **隔離性のレベル:**
VM はハードウェアレベルで完全に隔離されているためセキュリティ（堅牢性）が高いが、Docker はプロセスレベルの隔離であるため、ホストカーネルに依存する脆弱性のリスクが VM より高くなる。

### シークレット vs 環境変数
**【概要】**
* **環境変数 (Environment Variables):**
OS やコンテナのプロセスが実行される環境に対して、外部から動的に値を渡すための標準的な仕組み。API の URL やデバッグモードの ON/OFF など、非機密の設定値を渡すのに適している。
* **シークレット (Docker Secrets):**
データベースのパスワード、SSHキー、SSL証明書などの「機密情報」を安全にコンテナへ渡すために特化した機能。（※本来は Docker Swarm の機能だが、Docker Compose でもファイルベースで擬似的に利用可能である）。

**【主な相違点】**
* **セキュリティ（漏洩リスク）:**
環境変数として渡したパスワードは、ホスト側から docker inspect コマンドを実行するだけで誰でも平文で閲覧できてしまう。一方シークレットは、必要なコンテナの内部にのみ一時的なインメモリファイル（通常 `/run/secrets/` 配下の `tmpfs`）としてマウントされ、ディスクには書き込まれない。
* **ライフサイクル:**
環境変数はコンテナが破棄されるまで環境内に残り続けるが、シークレットはコンテナが停止するとメモリ上から安全に消滅する。

### Docker ネットワーク vs ホストネットワーク
**【概要】**
* **Docker ネットワーク (Bridgeネットワーク):**
Docker をインストールするとデフォルトで作成される、ホストマシン内部の仮想的な独立ネットワーク。このネットワークに所属するコンテナ同士は、IPアドレスではなく「コンテナ名（サービス名）」を使って互いに通信（名前解決）することができる。
* **ホストネットワーク (--network host)**
コンテナが独自のネットワーク空間を持たず、ホストマシンのネットワークインターフェース（IPアドレスやポート）を直接共有するモード。

**【主な相違点】**
* **ポートの扱い:**
Bridge では ポートマッピング (-p 8080:80) を使ってホストとコンテナのポートを紐付けるが、ホストネットワークではコンテナが使用するポート（例: 80番）がそのままホストの80番ポートとして占有される。
* **セキュリティと隔離性:**
Bridge ネットワークは外部から直接アクセスできず、許可されたポートのみを公開するため安全である。ホストネットワークは隔離性がなく、ポート競合（すでにホスト側で使っているポートと被る）のリスクがある。
* **パフォーマンス:**
ホストネットワークは、Bridge のような NAT（アドレス変換）の処理を挟まないため、ネットワークのオーバーヘッドが無く通信速度が最速になる。

### Docker ボリューム vs バインドマウント
**【概要】**
* **バインドマウント (Bind Mounts):**
ホストマシンの特定の絶対パス（例: `/home/user/project/src`）を、コンテナ内の特定のディレクトリ（例: `/app`）に直接マッピングする手法。初期のDockerから存在する機能である。
* **Docker ボリューム (Docker Volumes):**
Docker エンジン自身が管理する専用のストレージ領域（通常は Linux の `/var/lib/docker/volumes/` 配下）を作成し、それをコンテナにマウントする手法である。データの永続化においてDockerが公式に推奨している方法である。

**【主な相違点】**
* **管理主体と依存性:**
バインドマウントは「ホストOSのファイルシステム」に強く依存するため、Mac や Windows など異なるOS環境で動かそうとした際にパスの記述やパーミッションでエラーが起きやすい。ボリュームは Docker が完全に管理するため、ホストOSを問わず安全に動作する。
* **用途の違い:**
バインドマウントは、ホスト側でソースコードを編集して即座にコンテナ内に反映させたい「ローカル開発環境」に向いている。ボリュームは、データベースのデータ保存など、コンテナが削除されてもデータを安全に永続化・バックアップしたい「本番環境」に向いている。
