# Developer documentation
## 目次
- [環境構築手順](#環境構築手順)
- [プロジェクトのビルドと起動](#プロジェクトのビルドと起動)
- [コンテナとボリュームの管理](#コンテナとボリュームの管理)
- [データの保存場所と永続化の仕組み](#データの保存場所と永続化の仕組み)

## 環境構築手順
ゼロから開発環境をセットアップするための手順は以下の通りである 。
1. ホスト名の解決（`/etc/hosts`）:
ローカル環境でドメイン名を解決するため、ホストOS（VM）の `/etc/hosts` に以下の行を追記する。
   ```
   127.0.0.1   login.42.fr
   ```
2. 環境変数（`.env`）の配置:
`srcs/` ディレクトリ内に `.env` ファイルを作成し、データベースの認証情報やドメイン名、ログイン名などのシークレット情報を定義する。

## プロジェクトのビルドと起動
プロジェクトのビルドと起動は、Makefile と Docker Compose によって自動化されている 。
* コマンド: `make build`
* 内部挙動: このコマンドは裏で `docker compose -f ./srcs/docker-compose.yml --env-file srcs/.env up -d --build` を実行している。変更された Dockerfile や設定スクリプト（`nginx.sh` 等）を元にイメージを再構築し、コンテナをバックグラウンドで起動する。

## コンテナとボリュームの管理
開発およびデバッグにおいて、コンテナやボリュームを管理するための主要なコマンドは以下の通りである 。
* `make re`: 現在のコンテナを停止（`down`）し、再度ビルドして起動（`up -build`）する。
* `make fclean`: すべてのコンテナを停止し、Docker 内の未使用リソース、ネットワーク、ボリューム、さらにホストOS上の永続化データディレクトリを強制削除し、システムを完全な初期状態に戻す
* ログの確認: 各プロセスのエラーを特定する場合は、以下のコマンドでコンテナの標準出力を確認する。
  ```Bash
  docker logs nginx
  docker logs wordpress
  docker logs mariadb
  ```

## データの保存場所と永続化の仕組み
コンテナ破棄後もデータを保持するため、データの永続化が設定されている 。
* 保存場所（ホスト側）:
  * データベース: `/home/mizusato/data/mariadb`
  * WordPress ファイル: `/home/mizusato/data/wordpress`
* 永続化の仕組み:
`docker-compose.yml` 内の `volumes` 設定において、Docker 標準の管理領域ではなく、`driver_opts`（`type: none`, `o: bind`, `device: <host_path>`）を使用している。これにより、コンテナ内のディレクトリがホストOSの絶対パスに直接マウントされ、データの実体がホスト側のファイルシステムに永続化されるアーキテクチャとなっている。
